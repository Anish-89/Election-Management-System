<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voter Registration</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .logo-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .sub-heading {
            font-size: 16px;
            opacity: 0.8;
        }

        .form-container {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
            outline: none;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-label {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-block;
            transition: background-color 0.3s;
        }

        .file-input-label:hover {
            background-color: #2980b9;
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .file-name {
            margin-left: 10px;
            font-size: 14px;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .date-input {
            position: relative;
        }

        .date-input input {
            padding-right: 35px;
        }

        .date-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper:after {
            content: '‚ñº';
            font-size: 12px;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #777;
        }

        select.form-control {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 30px;
            cursor: pointer;
        }

        .otp-section {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .otp-input {
            flex: 1;
        }

        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #c0392b;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
            border-left: 4px solid #ddd;
        }

        .message.success {
            background-color: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .message.error {
            background-color: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .message.info {
            background-color: #d1ecf1;
            border-left-color: #17a2b8;
            color: #0c5460;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 600;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: var(--secondary-color);
        }

        .form-progress {
            display: flex;
            margin-bottom: 30px;
            position: relative;
        }

        .form-progress:before {
            content: "";
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background-color: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-number {
            background-color: var(--secondary-color);
        }

        .progress-step.completed .step-number {
            background-color: #27ae60;
        }

        .step-label {
            font-size: 14px;
            font-weight: 600;
        }

        .alert {
            padding: 0;
            margin: 5px 0;
            color: var(--accent-color);
            font-size: 14px;
            height: 0;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        .alert.show {
            height: auto;
            padding: 5px 0;
        }

        /* Form steps */
        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .form-progress {
                flex-direction: column;
                gap: 15px;
            }

            .form-progress:before {
                display: none;
            }

            .otp-section {
                flex-direction: column;
            }

            .container {
                padding: 10px;
            }

            .form-container {
                padding: 15px;
            }

            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .navigation-buttons .btn {
                width: 100%;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }

        .form-step .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-step .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-step .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-step .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-step .form-group:nth-child(5) { animation-delay: 0.5s; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <span class="logo-icon">üó≥Ô∏è</span>
            </div>
            <h2>Voter Registration</h2>
            <p class="sub-heading">Register to participate in the upcoming election</p>
        </header>

        <div class="form-container">
            <div class="form-progress">
                <div class="progress-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Personal Info</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Contact Details</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Verification</div>
                </div>
            </div>
            <form method="POST" enctype="multipart/form-data" id="VoterRegistrationForm">
                {% csrf_token %}
            
                <!-- Step 1: Personal Information -->
                <div class="form-step active" id="step1">
                    <div class="form-group">
                        <label for="student_id">Student ID</label>
                        {{ form.student_id }}
                        <div class="alert" id="student_id_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        {{ form.name }}
                        <div class="alert" id="name_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="date_of_birth">Date of Birth</label>
                        <div class="date-input">
                            {{ form.date_of_birth }}
                            <span class="date-icon">üìÖ</span>
                        </div>
                        <div class="alert" id="date_of_birth_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="profile_image">Profile Image</label>
                        <div class="file-input-container">
                            <label class="file-input-label">
                                Choose File
                                {{ form.profile_image }}
                            </label>
                            <span class="file-name" id="profile_image_name">No file chosen</span>
                        </div>
                    </div>
            
                    <div class="navigation-buttons">
                        <div></div> <!-- Empty div for spacing -->
                        <button type="button" class="btn" id="nextToStep2">Next</button>
                    </div>
                </div>
            
                <!-- Step 2: Contact Details and Additional Information -->
                <div class="form-step" id="step2">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        {{ form.email }}
                        <div class="alert" id="email_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        {{ form.phone }}
                        <div class="alert" id="phone_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="address">Address</label>
                        {{ form.address }}
                        <div class="alert" id="address_alert"></div>
                    </div>
            
                    <div class="form-group">
                        <label for="id_proof">ID Proof</label>
                        <div class="file-input-container">
                            <label class="file-input-label">
                                Choose File
                                {{ form.id_proof }}
                            </label>
                            <span class="file-name" id="id_proof_name">No file chosen</span>
                        </div>
                    </div>
            
                    <div class="form-group">
                        <label for="election_type">Election Type</label>
                        <div class="select-wrapper">
                            {{ form.election_type }}
                        </div>
                        <div class="alert" id="election_type_alert"></div>
                    </div>
            
                    <div class="navigation-buttons">
                        <button type="button" class="btn" id="backToStep1">Previous</button>
                        <button type="button" class="btn" id="nextToStep3">Next</button>
                    </div>
                </div>
            
                <!-- Step 3: Verification -->
                <div class="form-step" id="step3">
                    <div class="form-group">
                        <label for="otp">OTP Verification</label>
                        <div class="otp-section">
                            {{ form.otp }}
                            <button type="button" id="sendOtpBtn" class="btn">Send OTP</button>
                        </div>
                        <div id="otpMessage" class="message info" style="display: none;"></div>
                    </div>
            
                    <div class="form-group">
                        <div class="message info">
                            Please review your information before submitting. Once submitted, you will receive your voter ID via email.
                        </div>
                    </div>
            
                    <div class="navigation-buttons">
                        <button type="button" class="btn" id="backToStep2">Previous</button>
                        <button type="submit" class="btn btn-accent" id="submitForm">Register</button>
                    </div>
                </div>
            </form>
            

            <div id="messages" class="message" style="display: none;"></div>
            
            <a href="{% url 'home' %}" class="back-link">Back to Home</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const steps = document.querySelectorAll('.form-step');
          const progressSteps = document.querySelectorAll('.progress-step');
          const inputs = {
            student_id: { regex: /^[A-Za-z0-9]{5,12}$/, message: 'Student ID must be 5-12 alphanumeric characters.' },
            name: { regex: /^[A-Za-z\s]{3,50}$/, message: 'Please enter a valid name (3-50 characters).' },
            email: { regex: /^[^\s@]+@[^\s@]+\.[^\s@]+$/, message: 'Please enter a valid email address.' },
            phone: { regex: /^\d{10}$/, message: 'Please enter a valid 10-digit phone number.' },
            address: { minLength: 10, message: 'Address should be at least 10 characters long.' }
          };
    
          function goToStep(stepNumber) {
            steps.forEach(step => step.classList.remove('active'));
            document.getElementById(`step${stepNumber}`).classList.add('active');
            progressSteps.forEach(step => {
              step.classList.remove('active');
              step.classList.remove('completed');
            });
            for (let i = 1; i < stepNumber; i++) {
              progressSteps[i - 1].classList.add('completed');
            }
            progressSteps[stepNumber - 1].classList.add('active');
            document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
          }
    
          document.getElementById('nextToStep2').onclick = () => validateStep1() && goToStep(2);
          document.getElementById('backToStep1').onclick = () => goToStep(1);
          document.getElementById('nextToStep3').onclick = () => validateStep2() && goToStep(3);
          document.getElementById('backToStep2').onclick = () => goToStep(2);
    
          document.getElementById('profile_image').addEventListener('change', () => updateFileName('profile_image', 'profile_image_name'));
          document.getElementById('id_proof').addEventListener('change', () => updateFileName('id_proof', 'id_proof_name'));
    
          function updateFileName(inputId, displayId) {
            const input = document.getElementById(inputId);
            const display = document.getElementById(displayId);
            display.textContent = input.files.length > 0 ? input.files[0].name : 'No file chosen';
          }
    
          Object.keys(inputs).forEach(field => {
            const input = document.getElementById(field);
            const alert = document.getElementById(`${field}_alert`);
            input.addEventListener('blur', () => validateField(field, input.value));
            input.addEventListener('input', () => alert.classList.contains('show') && validateField(field, input.value));
          });
    
          function validateField(field, value) {
            const alert = document.getElementById(`${field}_alert`);
            const config = inputs[field];
            if (field === 'address') {
              if (value.length < config.minLength) return showAlert(alert, config.message), false;
            } else if (!config.regex.test(value)) {
              return showAlert(alert, config.message), false;
            }
            hideAlert(alert);
            return true;
          }
    
          function showAlert(element, message) {
            element.textContent = message;
            element.classList.add('show');
          }
    
          function hideAlert(element) {
            element.classList.remove('show');
            element.textContent = '';
          }
    
          function validateStep1() {
            return validateField('student_id', student_id.value) &
                   validateField('name', name.value) &
                   validateDOB();
          }
    
          function validateDOB() {
            const dobInput = document.getElementById('date_of_birth');
            const alert = document.getElementById('date_of_birth_alert');
            if (!dobInput.value) return showAlert(alert, 'Please enter your date of birth.'), false;
            const dob = new Date(dobInput.value);
            const age = new Date().getFullYear() - dob.getFullYear();
            if (age < 18) return showAlert(alert, 'You must be at least 18 years old to register.'), false;
            hideAlert(alert);
            return true;
          }
    
          function validateStep2() {
            return validateField('email', email.value) &
                   validateField('phone', phone.value) &
                   validateField('address', address.value) &
                   validateElectionType();
          }
    
          function validateElectionType() {
            const el = document.getElementById('election_type');
            const alert = document.getElementById('election_type_alert');
            if (!el.value) return showAlert(alert, 'Please select an election type.'), false;
            hideAlert(alert);
            return true;
          }
    
          // ‚úÖ Corrected form submission logic
          document.getElementById('VoterRegistrationForm').addEventListener('submit', function (event) {
            const otpInput = document.getElementById('otp');
            const otpMessage = document.getElementById('otpMessage');
    
            if (!otpInput.value || otpInput.value.length !== 6) {
              event.preventDefault();
              otpMessage.textContent = 'Please enter a valid 6-digit OTP.';
              otpMessage.className = 'message error';
              otpMessage.style.display = 'block';
              return;
            }
    
            showMessage('Submitting your registration...', 'info');
          });
    
          // OTP Request
          document.getElementById('sendOtpBtn').onclick = function () {
            const studentId = student_id.value;
            const emailVal = email.value;
            if (!studentId || !inputs.student_id.regex.test(studentId)) return showAlert(student_id_alert, inputs.student_id.message);
            if (!emailVal || !inputs.email.regex.test(emailVal)) return showAlert(email_alert, 'Enter a valid email.');
    
            const otpMessage = document.getElementById('otpMessage');
            otpMessage.textContent = 'Sending OTP...';
            otpMessage.className = 'message info';
            otpMessage.style.display = 'block';
    
            fetch(`/send-otp/?student_id=${studentId}`)
              .then(r => r.json())
              .then(data => {
                otpMessage.textContent = data.message || 'OTP sent!';
                otpMessage.className = data.success ? 'message success' : 'message error';
                if (data.success) {
                  otp.focus();
                  let countdown = 60;
                  const btn = this;
                  btn.disabled = true;
                  const original = btn.textContent;
                  const timer = setInterval(() => {
                    btn.textContent = `Resend (${countdown--}s)`;
                    if (countdown < 0) {
                      clearInterval(timer);
                      btn.disabled = false;
                      btn.textContent = original;
                    }
                  }, 1000);
                }
              })
              .catch(err => {
                otpMessage.textContent = 'Failed to send OTP.';
                otpMessage.className = 'message error';
              });
          };
    
          function showMessage(msg, type = 'info') {
            const box = document.getElementById('messages');
            box.textContent = msg;
            box.className = `message ${type}`;
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth' });
          }
        });
      </script>
</body>
</html>